<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Anime Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }

    #searchSection {
      display: block;
    }

    input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: none;
    }

    .result {
      background: #222;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 6px;
    }

    .result button {
      background: #0af;
      color: #fff;
      border: none;
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 6px;
      margin-top: 10px;
    }

    /* Fullscreen Player Mode */
    #playerModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      z-index: 9999;
    }

    #fullscreenContainer {
      width: 100%;
      height: 100%;
    }

    #fullscreenContainer iframe {
      width: 100vw;
      height: 100vh;
      border: none;
      display: block;
    }
  </style>
</head>
<body>

  <div id="searchSection">
    <h2>ðŸŽ¬ Anime Search</h2>
    <input type="text" id="searchInput" placeholder="Search anime or episode...">
    <div id="results"></div>
  </div>

  <!-- Fullscreen Container -->
  <div id="playerModal">
    <div id="fullscreenContainer"></div>
  </div>

  <script>
    const jsonFiles = ['part1.json', 'part2.json']; // Add more if needed
    let allVideos = [];

    async function loadJSONFiles() {
      const fetches = jsonFiles.map(file =>
        fetch(file)
          .then(res => res.ok ? res.json() : [])
          .catch(() => [])
      );
      const allData = await Promise.all(fetches);
      allVideos = allData.flat();
      console.log("Loaded:", allVideos);
    }

    function searchVideos(query) {
      const lower = query.trim().toLowerCase();
      return allVideos.filter(item =>
        item.title.toLowerCase().includes(lower) ||
        item.episode.toLowerCase().includes(lower)
      );
    }

    function showResults(results) {
      const container = document.getElementById('results');
      container.innerHTML = '';
      if (results.length === 0) {
        container.innerHTML = '<p>No results found.</p>';
        return;
      }

      results.forEach(video => {
        const div = document.createElement('div');
        div.className = 'result';
        div.innerHTML = `
          <strong>${video.title}</strong> - ${video.episode}<br>
          <button onclick='playVideo(\`${video.iframe.replace(/`/g, "\\`")}\`)'>Play</button>
        `;
        container.appendChild(div);
      });
    }

    // Play the video and hide search page
    async function playVideo(iframeHtml) {
      const modal = document.getElementById('playerModal');
      const container = document.getElementById('fullscreenContainer');
      const search = document.getElementById('searchSection');

      container.innerHTML = iframeHtml;
      modal.style.display = 'block';
      search.style.display = 'none';

      try {
        // Fullscreen
        if (modal.requestFullscreen) await modal.requestFullscreen();
        if (screen.orientation && screen.orientation.lock) {
          await screen.orientation.lock('landscape');
        }

        // Push state to trigger back button
        history.pushState({ playing: true }, '');
      } catch (e) {
        console.warn('Fullscreen or orientation lock failed:', e);
      }
    }

    // Handle exit (back button or user exit)
    function exitPlayer() {
      document.getElementById('playerModal').style.display = 'none';
      document.getElementById('searchSection').style.display = 'block';
      document.getElementById('fullscreenContainer').innerHTML = '';
      if (document.fullscreenElement) {
        document.exitFullscreen();
      }
    }

    // Exit when fullscreen changes
    document.addEventListener('fullscreenchange', () => {
      if (!document.fullscreenElement) {
        exitPlayer();
      }
    });

    // Search listener
    document.getElementById('searchInput').addEventListener('input', e => {
      const results = searchVideos(e.target.value);
      showResults(results);
    });

    // Handle browser back button
    window.onpopstate = function (event) {
      if (event.state && event.state.playing) {
        exitPlayer();
      }
    };

    loadJSONFiles();
  </script>
</body>
</html>