<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Video Player</title>
  <style>
    body { background: #000; color: white; font-family: Arial; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    #loading { margin-top: 20vh; font-size: 20px; color: yellow; }
    #video-container { display: none; width: 100%; max-width: 960px; height: 540px; }
    iframe { width: 100%; height: 100%; border: none; }
    #back { margin-bottom: 20px; background: red; border: none; padding: 10px 16px; color: white; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>

  <button id="back" onclick="history.back()">⬅️ Back</button>
  <div id="loading">⏳ Loading video...</div>
  <div id="video-container"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const title = decodeURIComponent(params.get("title"));
    const epNum = decodeURIComponent(params.get("ep"));

    const jsonFiles = ["popular.json", "action.json", "slice_of_life.json", "sci-fi.json", "drama.json", "comedy.json", "fantasy.json"];

    Promise.all(jsonFiles.map(file => fetch(file).then(r => r.json())))
      .then(files => {
        const allAnime = files.flat();
        const anime = allAnime.find(a => a.anime_name.toLowerCase() === title.toLowerCase());
        if (!anime) return document.getElementById("loading").innerText = "❌ Anime not found.";

        const episode = anime.episodes.find(e => e.episode.toLowerCase() === epNum.toLowerCase());
        if (!episode) return document.getElementById("loading").innerText = "❌ Episode not found.";

        setTimeout(() => {
          document.getElementById("loading").style.display = "none";
          const player = document.getElementById("video-container");
          player.innerHTML = episode.iframe;
          player.style.display = "block";
        }, 3000);
      });
  </script>
</body>
</html>